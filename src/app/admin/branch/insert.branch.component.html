<div class="ui container" style="overflow:hidden;">
    <form novalidate [formGroup]="dataForm">
        <div class="ui stackable grid container" style="padding-top:10px;">
            <div class="row" style="padding-bottom:5px;padding-right:10px;">
                <div class="eight wide column">
                    <div class="ui grid">
                        <div class="eight wide column" formGroupName="department">
                            <mat-form-field style="width:200px;">
                                <input matInput placeholder="امور شعب مربوطه" aria-label="امور شعب مربوطه" [matAutocomplete]="autoDepartment" formControlName="dep_name"
                                    required>
                                <mat-autocomplete #autoDepartment="matAutocomplete" (optionSelected)="department_select($event)">
                                    <mat-option *ngFor="let o of dep_list_obser | async" [value]="o.dep_name">
                                        {{o.dep_name}}
                                    </mat-option>
                                </mat-autocomplete>
                            </mat-form-field>
                        </div>
                        <div class="eight wide column" formGroupName="hoze">
                            <mat-form-field style="width:200px;">
                                <mat-select placeholder="لیست حوزه ها" (selectionChange)="hozeSelect($event)" formControlName="hoze_name" required>
                                    <mat-option>None</mat-option>
                                    <mat-option *ngFor="let h of hoze_list" [value]="h.hoze_name">{{h.hoze_name}}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="row">
                        <div class="wide column">
                            <div class="ui divider"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="ui grid">
                            <div class="five wide column">
                                <mat-form-field style="width:150px;">
                                    <input matInput formControlName="branch_code" autocomplete="off" placeholder="کد شعبه" style="text-align:center;" maxlength="4"
                                        required>
                                    <mat-error align="right" *ngIf="dataForm.get('branch_code').invalid">{{getErrorMessage(dataForm.get('branch_code'))}}</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="eleven wide column">
                                <mat-form-field>
                                    <mat-select placeholder="درجه شعبه" formControlName="branch_degree" style="text-align:center;" required>
                                        <mat-option>None</mat-option>
                                        <mat-option *ngFor="let d of degree_list" [value]="d">{{d}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="ui grid">
                            <div class="wide column">
                                <mat-form-field style="width:300px;">
                                    <input matInput formControlName="branch_name" autocomplete="off" placeholder="نام شعبه" style="text-align:center;" required>
                                    <mat-error align="right" *ngIf="dataForm.get('branch_name').invalid">{{getErrorMessage(dataForm.get('branch_name'))}}</mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="ui grid">
                            <div class="eight wide column">
                                <mat-form-field style="width:150px;">
                                    <input matInput formControlName="branch_code_posti" autocomplete="off" placeholder="کد پستی" style="text-align:center;" maxlength="10">
                                    <mat-error align="right" *ngIf="dataForm.get('branch_code_posti').invalid">{{getErrorMessage(dataForm.get('branch_code_posti'))}}</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="eight wide column">
                                <mat-form-field style="width:200px;">
                                    <input matInput formControlName="branch_email" autocomplete="off" placeholder="آدرس ایمیل" style="text-align:left;direction:ltr;">
                                    <mat-error align="right" *ngIf="dataForm.get('branch_email').invalid">{{getErrorMessage(dataForm.get('branch_email'))}}</mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="ui grid">
                            <div class="wide column">
                                <mat-form-field style="width:100%;">
                                    <input matInput formControlName="branch_address" autocomplete="off" placeholder="آدرس پستی" style="text-align:right;">
                                    <mat-error align="right" *ngIf="dataForm.get('branch_address').invalid">{{getErrorMessage(dataForm.get('branch_address'))}}</mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="eight wide column">
                    <div class="ui grid">
                        <div class="ten wide column" formGroupName="ostan">
                            <mat-form-field style="width:250px;">
                                <mat-select placeholder="لیست استان ها" formControlName="ostan_name" (selectionChange)="ostanSelect($event)" required>
                                    <mat-option>None</mat-option>
                                    <mat-option *ngFor="let o of ostan_list" [value]="o.ostan_name">{{o.ostan_name}}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="six wide column" formGroupName="city">
                            <mat-form-field style="width:100%;" *ngIf="dataForm.get('ostan').get('ostan_name').value">
                                <input matInput placeholder="شهر/شهرستان/..." aria-label="شهر/شهرستان/..." [matAutocomplete]="autoCity" formControlName="city_name"
                                    required>
                                <mat-autocomplete #autoCity="matAutocomplete" (optionSelected)="citySelect($event)">
                                    <mat-option *ngFor="let c of city_list_obser | async" [value]="c.city_name">
                                        {{c.city_name}}
                                    </mat-option>
                                </mat-autocomplete>
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="row">
                        <div class="wide column">
                            <div class="ui divider"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="ui grid">
                            <div class="eight wide column">
                                <mat-form-field style="width:250px;">
                                    <mat-select placeholder="نوع خدمات" formControlName="khadamat_type" multiple required>
                                        <mat-option *ngFor="let k of khedmat_list" [value]="k">{{k}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="eight wide column">
                                <mat-form-field style="width:250px;">
                                    <mat-select placeholder="ارائه دهنده خدمات به..." formControlName="organ_type" required>
                                        <mat-option *ngFor="let o of organ_list" [value]="o">{{o}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="ui grid">
                            <div class="five wide column">
                                <mat-form-field style="width:100%;">
                                    <mat-select placeholder="نوع واحد" formControlName="branch_type" required>
                                        <mat-option *ngFor="let b of branch_type_list" [value]="b">{{b}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="five wide column">
                                <mat-form-field style="width:100px;" *ngIf="dataForm.get('branch_type').value == 'باجه'">
                                    <input matInput formControlName="main_branch_code" autocomplete="off" placeholder="کد شعبه مادر" style="text-align:center;">
                                    <mat-error align="right" *ngIf="dataForm.get('main_branch_code').invalid">{{getErrorMessage(dataForm.get('main_branch_code'))}}</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="six wide column">
                                <mat-form-field *ngIf="dataForm.get('branch_type').value == 'باجه'">
                                    <input matInput formControlName="dist_to_main_branch" autocomplete="off" placeholder="فاصله تا شعبه مادر" style="text-align:center;">
                                    <mat-error align="right" *ngIf="dataForm.get('dist_to_main_branch').invalid">{{getErrorMessage(dataForm.get('dist_to_main_branch'))}}</mat-error>
                                </mat-form-field>

                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="ui grid">
                            <div class="eight wide column">
                                <mat-form-field style="width:250px;">
                                    <mat-select placeholder="فعالیت شعبه در محدوده ... " multiple formControlName="activity_type" required>
                                        <mat-option *ngFor="let a of activity_type_list" [value]="a">{{a}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="eight wide column">
                                <mat-form-field style="width:250px;">
                                    <mat-select placeholder="نوع فعالیت ارزی" formControlName="arz_type" required>
                                        <mat-option *ngFor="let a of arz_type_list" [value]="a">{{a}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="ui grid">
                            <div class="eight wide column">
                                <mat-form-field style="width:150px;">
                                    <input matInput="matInput" formControlName="branch_start_date" placeholder="تاریخ تاسیس بکار" style="text-align:center;direction:ltr;"
                                        [textMask]="{mask: _mask_date}" autocomplete="off">
                                    <mat-hint align="end">مثال: 1360/11/22 </mat-hint>
                                    <mat-error align="right" *ngIf="dataForm.get('branch_start_date').invalid">{{getErrorMessage(dataForm.get('branch_start_date'))}}</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="eight wide column">
                                <mat-form-field style="width:150px;">
                                    <input matInput="matInput" formControlName="branch_activity_date" placeholder="تاریخ شروع بکار" style="text-align:center;direction:ltr;"
                                        [textMask]="{mask: _mask_date}" autocomplete="off">
                                    <mat-hint align="end">مثال: 1360/11/22 </mat-hint>
                                    <mat-error align="right" *ngIf="dataForm.get('branch_activity_date').invalid">{{getErrorMessage(dataForm.get('branch_activity_date'))}}</mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" style="padding-top:0px;padding-bottom:0px;padding-right:10px;">
                <div class="wide column">
                    <div class="ui divider"></div>
                </div>
            </div>
            <div class="row" style="padding-top:0px;padding-right:10px;">
                <div class="wide left aligned column">
                    <a class="ui teal tag label">{{date_message}}</a>
                    <button mat-raised-button ripple color="accent" *ngIf="state_save" [disabled]="!dataForm.valid" (click)="save_branch(dataForm.value)"
                        type="button">ذخیره اطلاعات</button>
                    <button mat-raised-button ripple color="primary" *ngIf="!state_save" [disabled]="!dataForm.valid" (click)="update_branch(dataForm.value)"
                        type="button">ویرایش اطلاعات</button>
                    <button mat-icon-button ripple color="primary" type="button" title="Excel" (click)="export()">
                        <i class="fa fa-download fa-lg"></i>
                    </button>
                    <button mat-icon-button ripple color="primary" type="reset" (click)="resetForm()" title="پاک کردن صفحه">
                        <i class="fa fa-refresh fa-lg"></i>
                    </button>
                </div>
            </div>
            <div class="row" style="padding-top:0px;padding-bottom:0px;padding-right:10px;">
                <div class="wide column">
                    <div class="ui divider"></div>
                </div>
            </div>
            <div class="row" style="padding-bottom:25px;padding-right:10px;">
                <div class="wide column">
                    <div class="mat-elevation-z4">
                        <div class="filter-header">
                            <mat-form-field style="width:100%;">
                                <input #inputFilter matInput (keyup)="applyFilter($event.target.value)" placeholder="جستجو" autocomplete="off">
                            </mat-form-field>
                        </div>
                        <mat-table #datagrid [dataSource]="dataSource" matSort>
                            <ng-container matColumnDef="select">
                                <mat-header-cell *matHeaderCellDef class="col-select"> </mat-header-cell>
                                <mat-cell class="col-select" *matCellDef="let row">
                                    <mat-checkbox (click)="selectRow(row)" (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)">
                                    </mat-checkbox>
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="branch_code">
                                <mat-header-cell *matHeaderCellDef mat-sort-header> کد شعبه </mat-header-cell>
                                <mat-cell class="col-branch_code" *matCellDef="let element"> {{element.branch_code}} </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="branch_name">
                                <mat-header-cell *matHeaderCellDef mat-sort-header> نام شعبه </mat-header-cell>
                                <mat-cell class="col-branch_name" *matCellDef="let element"> {{element.branch_name}} </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="branch_degree">
                                <mat-header-cell *matHeaderCellDef mat-sort-header> درجه شعبه </mat-header-cell>
                                <mat-cell class="col-branch_degree" *matCellDef="let element"> {{element.branch_degree}} </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="branch_type">
                                <mat-header-cell *matHeaderCellDef mat-sort-header> نوع واحد </mat-header-cell>
                                <mat-cell class="col-branch_type" *matCellDef="let element"> {{element.branch_type}} </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="city_name">
                                    <mat-header-cell *matHeaderCellDef mat-sort-header> شهر </mat-header-cell>
                                    <mat-cell class="col-city_name" *matCellDef="let element"> {{element.city.city_name}} </mat-cell>
                                </ng-container>
                            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                            <mat-row *matRowDef="let row; columns: displayedColumns;" 
                                [ngClass]="{'row-select': selectedRowIndex == row.branch_code}" 
                                (click)="selectRow(row)"></mat-row>
                        </mat-table>
                        <mat-paginator #paginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20]">
                        </mat-paginator>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
<!-- <pre style="direction:ltr;">
    {{dataForm.value | json}}
</pre> -->